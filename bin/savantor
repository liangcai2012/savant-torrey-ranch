#!/usr/bin/env python
# pylint: disable=invalid-name
"""
Command-line interface to Savant administrative tools
"""

import argparse

parser = argparse.ArgumentParser(description="SavantDB administrative tools")
subparsers = parser.add_subparsers(title="subcommands")

# Database CLI
db_parser = subparsers.add_parser("db", help="manage database")
db_parsers = db_parser.add_subparsers(title="database subcommands")

# Subparser 'setup-database'
def setup_db(args):
    """
    setup Savant DB
    """
    from savant.db import admin
    admin.setup_database(alembic_config_path=args.alembic_config_path, reset=args.reset)


setup_parser = db_parsers.add_parser("setup", help="initialize SavantDB tables if not exist")
setup_parser.add_argument("-r", "--reset", dest="reset", action="store_true", help="reset db tables")
setup_parser.add_argument("-c", "--alembic-config", metavar="ALEMBIC_CONFIG", dest="alembic_config_path", help="path to alembic.ini")
setup_parser.set_defaults(func=setup_db)

# Subparser IPO Populater
def download_ipo(args):
    """
    IPO data for Savant DB
    """
    if args.populate:
        from savant.scraper import populate_db

ipo_parser = db_parsers.add_parser("ipo", help="download ipo info from NASDAQ")
ipo_parser.add_argument("-p", "--populate", dest="populate", action="store_true", help="populate ipo data")
ipo_parser.set_defaults(func=download_ipo)

args = parser.parse_args()
args.func(args)
